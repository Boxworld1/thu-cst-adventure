## 2-4-2 Kidd  解题报告 ##

#### 容逸朗 2020010869 ####

### 1  解法 ###

题目包含两种操作，一个是对区间内所有数据加 `1` ，另一个是查询区间内的数据总和。利用带有懒人标记的线段树即可解决这个问题。

需要注意的是，本题虽然思路较为简单，但仍然要注意一些事项。

#### 1.1 很大的n

题目的数据量 $n<2^{31}$ ，对于这种规模的数据，常规线段树需要 $4n = 2^{33}$ 的空间存放数据，这个数量的数据显然超出了 `256MB` 空间可存储的数据量。不过，注意到 $m\leq 200000$ ，也就是说实际操作到的区间端点最多只有 $2m = 400000$ 个，因此我们可以将数据离散化存储。

#### 1.2 选择线段树节点

离散化存储会带来一个问题，就是查找/更改区间不明确，为此我们需要规定数据映射后的区间表示法作出规定，一个方法是左闭右开区间，这时会出现一个问题：

```
对于 1, 5, 7 这组数据，线段树可表示的区间仅有 [1,5), [5,7), [7,n+1), [1,7) 和 [1,n+1) ，此时欲查询区间 [1,1] 即左闭右开区间 [1,2) 便会失败。
```

一个解决方法是在所有原有端点后方增加一个"哨兵"，其值比端点值大 `1` ，此时：

```
对于 1, 5, 7 这组数据，可以增加端点 2, 6, 8。
此时线段树可接受的区间包括 [1,2), [2,5), [5,6), [6,7), [7,8) ，由这些区间可以得到原线段树可表达的所有区间。
```

此时，线段树最多有端点 $2\times 2m=4m$ 个，需要储存空间 $4\times 4m=16m$ 。

由此知算法的时间复杂度为 $O(m\log m)$ ，空间复杂度为 $O(m)$ 。

### 2  其他事项

在开始算法之前，可以先对端点进行排序并添加适当的"哨兵"端点，然后进行建树操作，计算不同区间对应的长度，以简化后续算法。

为了得到读入数据到线段树端点的映射值，我们还需要一个二分查找的方法来得到这个值。

由于答案可能很大，因此在计算答案的过程中要特別注意越界的问题，在适当的时候转换值的类型为 `long long` ，同时要注意边界值 `2^31-1` 的哨兵值为 `2^31` ，已经超出了 `int` 能表示的最大值，故需要使用 `unsigned int` 或 `long long` 內存储。

